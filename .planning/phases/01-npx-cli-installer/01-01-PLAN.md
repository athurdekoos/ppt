---
phase: 1
plan: 1
name: "npx CLI installer"
wave: 1
depends_on: []
files_modified:
  - package.json
  - bin/install.mjs
autonomous: true
requirements:
  - CLI-01
  - CLI-02
  - CLI-03
  - CLI-04
  - PREREQ-01
  - PREREQ-02
  - PREREQ-03
  - INST-01
  - INST-02
  - INST-03
  - INST-04
  - PKG-01
  - PKG-02
  - PKG-03
---

# Plan: npx CLI Installer

<objective>
Create a Node.js CLI that installs the openteams-pptx skill for pi or Claude Code when invoked via `npx https://github.com/athurdekoos/ppt --pi` or `--claude`. Uses only Node.js built-ins. Checks Python prereqs, backs up existing installs, copies skill files.
</objective>

<tasks>

<task id="1" title="Create package.json at repo root">
Create `package.json` with:
- `name`: `openteams-pptx`
- `version`: `1.0.0`
- `bin`: `{ "openteams-pptx": "./bin/install.mjs" }`
- `description`: "Install the OpenTeams PPTX Generator skill for pi or Claude Code"
- `files`: `["bin/", "openteams-pptx/"]` — tells npm which files to include
- No `dependencies` — Node.js built-ins only

Verify: `node -e "require('./package.json')"` parses without error.
</task>

<task id="2" title="Create bin/install.mjs CLI entry point">
Create `bin/install.mjs` with `#!/usr/bin/env node` shebang.

**Argument parsing:**
- Parse `process.argv` for `--pi` and `--claude` flags
- If neither flag: print usage help and exit 1
- If both flags: print error ("pick one") and exit 1

**Usage help output:**
```
OpenTeams PPTX Skill Installer

Usage:
  npx https://github.com/athurdekoos/ppt --pi       Install for pi coding agent
  npx https://github.com/athurdekoos/ppt --claude    Install for Claude Code

Options:
  --pi       Install to ~/.pi/agent/skills/openteams-pptx/
  --claude   Install to ~/.agents/skills/openteams-pptx/
```

**Target directories:**
- `--pi` → `~/.pi/agent/skills/openteams-pptx/`
- `--claude` → `~/.agents/skills/openteams-pptx/`

**Step 1 — Check Python 3:**
- Run `python3 --version` via `child_process.execSync`
- If fails: print error with install instructions (Ubuntu: `sudo apt install python3`, macOS: `brew install python3`), exit 1

**Step 2 — Check/install python-pptx:**
- Run `python3 -c "import pptx"` via `execSync`
- If fails: print "Installing python-pptx..." and run `pip3 install python-pptx`
- If pip3 fails: print manual instructions (`pip3 install python-pptx`), continue anyway (don't block install)

**Step 3 — Backup existing install:**
- If target directory exists: rename to `<target>.backup.<ISO-timestamp>`
- Print backup path

**Step 4 — Copy skill files:**
- Resolve source: `path.join(__dirname, '..', 'openteams-pptx')`
- Create target directory with `fs.mkdirSync(target, { recursive: true })`
- Copy these items only: `SKILL.md`, `README.md`, `scripts/`, `references/`, `assets/`, `docs/`
- Use recursive copy helper (Node 16.7+ has `fs.cpSync` with `{ recursive: true }`)
- Skip: `tests/`, `install_*.sh`, `__pycache__/`, `.git`

**Step 5 — Print success:**
```
✓ Installed openteams-pptx to <target>

  For pi:          /skill:openteams-pptx in any session
  For Claude Code: Add to your project's CLAUDE.md available_skills

  To uninstall:    rm -rf <target>
```

**Progress messages throughout:**
```
◆ Checking Python 3...          ✓ Python 3.x.x
◆ Checking python-pptx...       ✓ python-pptx available
◆ Backing up existing install... ✓ Backed up to <path>
◆ Installing skill files...     ✓ Copied to <target>
```

Use only: `fs`, `path`, `child_process`, `os` (all Node.js built-ins).
</task>

<task id="3" title="Make CLI executable and test">
- Run `chmod +x bin/install.mjs`
- Test no-flag case: `node bin/install.mjs` → should print usage and exit 1
- Test `--pi` flag: `node bin/install.mjs --pi` → should install to `~/.pi/agent/skills/openteams-pptx/`
- Verify installed files: `ls ~/.pi/agent/skills/openteams-pptx/SKILL.md`
- Test idempotency: run `--pi` again → should backup previous and succeed
- Test `--claude` flag: `node bin/install.mjs --claude` → should install to `~/.agents/skills/openteams-pptx/`
</task>

</tasks>

<verification>
After all tasks:
1. `node bin/install.mjs` prints usage help (exit 1)
2. `node bin/install.mjs --pi` installs skill with all required files
3. `node bin/install.mjs --claude` installs skill to Claude Code location
4. Re-running creates backup of previous install
5. Python 3 check works (test by verifying message output)
6. `cat package.json | node -e "JSON.parse(require('fs').readFileSync(0,'utf8'))"` validates JSON
7. No npm dependencies — only Node.js built-ins used
</verification>

<must_haves>
- package.json with bin field exists at repo root
- bin/install.mjs is executable with node shebang
- --pi installs to ~/.pi/agent/skills/openteams-pptx/
- --claude installs to ~/.agents/skills/openteams-pptx/
- No flag prints usage help
- Python 3 checked before install
- python-pptx auto-installed if missing
- Existing install backed up
- Only skill files copied (no tests, no .sh, no __pycache__)
</must_haves>
